(function(e){String.prototype.trim===e&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.reduce===e&&(Array.prototype.reduce=function(t){if(this===void 0||null===this)throw new TypeError;var n,i=Object(this),r=i.length>>>0,o=0;if("function"!=typeof t)throw new TypeError;if(0==r&&1==arguments.length)throw new TypeError;if(arguments.length>=2)n=arguments[1];else for(;;){if(o in i){n=i[o++];break}if(++o>=r)throw new TypeError}for(;r>o;)o in i&&(n=t.call(e,n,i[o],o,i)),o++;return n})})();var Zepto=function(){function e(e){return null==e?e+"":K[W.call(e)]||"object"}function t(t){return"function"==e(t)}function n(e){return null!=e&&e==e.window}function i(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function r(t){return"object"==e(t)}function o(e){return r(e)&&!n(e)&&e.__proto__==Object.prototype}function s(e){return e instanceof Array}function a(e){return"number"==typeof e.length}function d(e){return A.call(e,function(e){return null!=e})}function l(e){return e.length>0?k.fn.concat.apply([],e):e}function u(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function c(e){return e in N?N[e]:N[e]=RegExp("(^|\\s)"+e+"(\\s|$)")}function f(e,t){return"number"!=typeof t||D[u(e)]?t:t+"px"}function p(e){var t,n;return M[e]||(t=F.createElement(e),F.body.appendChild(t),n=L(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==n&&(n="block"),M[e]=n),M[e]}function h(e){return"children"in e?I.call(e.children):k.map(e.childNodes,function(e){return 1==e.nodeType?e:T})}function m(e,t,n){for(_ in t)n&&(o(t[_])||s(t[_]))?(o(t[_])&&!o(e[_])&&(e[_]={}),s(t[_])&&!s(e[_])&&(e[_]=[]),m(e[_],t[_],n)):t[_]!==T&&(e[_]=t[_])}function v(e,t){return t===T?k(e):k(e).filter(t)}function g(e,n,i,r){return t(n)?n.call(e,i,r):n}function b(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function y(e,t){var n=e.className,i=n&&n.baseVal!==T;return t===T?i?n.baseVal:n:(i?n.baseVal=t:e.className=t,T)}function w(e){var t;try{return e?"true"==e||("false"==e?!1:"null"==e?null:isNaN(t=Number(e))?/^[\[\{]/.test(e)?k.parseJSON(e):e:t):e}catch(n){return e}}function x(e,t){t(e);for(var n in e.childNodes)x(e.childNodes[n],t)}var T,_,k,E,S,$,C=[],I=C.slice,A=C.filter,F=window.document,M={},N={},L=F.defaultView.getComputedStyle,D={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},O=/^\s*<(\w+|!)[^>]*>/,P=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,j=/^(?:body|html)$/i,R=["val","css","html","text","data","width","height","offset"],H=["after","prepend","before","append"],V=F.createElement("table"),z=F.createElement("tr"),U={tr:F.createElement("tbody"),tbody:V,thead:V,tfoot:V,td:z,th:z,"*":F.createElement("div")},q=/complete|loaded|interactive/,Z=/^\.([\w-]+)$/,J=/^#([\w-]*)$/,B=/^[\w-]+$/,K={},W=K.toString,X={},Y=F.createElement("div");return X.matches=function(e,t){if(!e||1!==e.nodeType)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var i,r=e.parentNode,o=!r;return o&&(r=Y).appendChild(e),i=~X.qsa(r,t).indexOf(e),o&&Y.removeChild(e),i},S=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},$=function(e){return A.call(e,function(t,n){return e.indexOf(t)==n})},X.fragment=function(e,t,n){e.replace&&(e=e.replace(P,"<$1></$2>")),t===T&&(t=O.test(e)&&RegExp.$1),t in U||(t="*");var i,r,s=U[t];return s.innerHTML=""+e,r=k.each(I.call(s.childNodes),function(){s.removeChild(this)}),o(n)&&(i=k(r),k.each(n,function(e,t){R.indexOf(e)>-1?i[e](t):i.attr(e,t)})),r},X.Z=function(e,t){return e=e||[],e.__proto__=k.fn,e.selector=t||"",e},X.isZ=function(e){return e instanceof X.Z},X.init=function(e,n){if(e){if(t(e))return k(F).ready(e);if(X.isZ(e))return e;var i;if(s(e))i=d(e);else if(r(e))i=[o(e)?k.extend({},e):e],e=null;else if(O.test(e))i=X.fragment(e.trim(),RegExp.$1,n),e=null;else{if(n!==T)return k(n).find(e);i=X.qsa(F,e)}return X.Z(i,e)}return X.Z()},k=function(e,t){return X.init(e,t)},k.extend=function(e){var t,n=I.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),n.forEach(function(n){m(e,n,t)}),e},X.qsa=function(e,t){var n;return i(e)&&J.test(t)?(n=e.getElementById(RegExp.$1))?[n]:[]:1!==e.nodeType&&9!==e.nodeType?[]:I.call(Z.test(t)?e.getElementsByClassName(RegExp.$1):B.test(t)?e.getElementsByTagName(t):e.querySelectorAll(t))},k.contains=function(e,t){return e!==t&&e.contains(t)},k.type=e,k.isFunction=t,k.isWindow=n,k.isArray=s,k.isPlainObject=o,k.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},k.inArray=function(e,t,n){return C.indexOf.call(t,e,n)},k.camelCase=S,k.trim=function(e){return e.trim()},k.uuid=0,k.support={},k.expr={},k.map=function(e,t){var n,i,r,o=[];if(a(e))for(i=0;e.length>i;i++)n=t(e[i],i),null!=n&&o.push(n);else for(r in e)n=t(e[r],r),null!=n&&o.push(n);return l(o)},k.each=function(e,t){var n,i;if(a(e)){for(n=0;e.length>n;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(i in e)if(t.call(e[i],i,e[i])===!1)return e;return e},k.grep=function(e,t){return A.call(e,t)},window.JSON&&(k.parseJSON=JSON.parse),k.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){K["[object "+t+"]"]=t.toLowerCase()}),k.fn={forEach:C.forEach,reduce:C.reduce,push:C.push,sort:C.sort,indexOf:C.indexOf,concat:C.concat,map:function(e){return k(k.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return k(I.apply(this,arguments))},ready:function(e){return q.test(F.readyState)?e(k):F.addEventListener("DOMContentLoaded",function(){e(k)},!1),this},get:function(e){return e===T?I.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){return C.every.call(this,function(t,n){return e.call(t,n,t)!==!1}),this},filter:function(e){return t(e)?this.not(this.not(e)):k(A.call(this,function(t){return X.matches(t,e)}))},add:function(e,t){return k($(this.concat(k(e,t))))},is:function(e){return this.length>0&&X.matches(this[0],e)},not:function(e){var n=[];if(t(e)&&e.call!==T)this.each(function(t){e.call(this,t)||n.push(this)});else{var i="string"==typeof e?this.filter(e):a(e)&&t(e.item)?I.call(e):k(e);this.forEach(function(e){0>i.indexOf(e)&&n.push(e)})}return k(n)},has:function(e){return this.filter(function(){return r(e)?k.contains(this,e):k(this).find(e).size()})},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!r(e)?e:k(e)},last:function(){var e=this[this.length-1];return e&&!r(e)?e:k(e)},find:function(e){var t,n=this;return t="object"==typeof e?k(e).filter(function(){var e=this;return C.some.call(n,function(t){return k.contains(t,e)})}):1==this.length?k(X.qsa(this[0],e)):this.map(function(){return X.qsa(this,e)})},closest:function(e,t){var n=this[0],r=!1;for("object"==typeof e&&(r=k(e));n&&!(r?r.indexOf(n)>=0:X.matches(n,e));)n=n!==t&&!i(n)&&n.parentNode;return k(n)},parents:function(e){for(var t=[],n=this;n.length>0;)n=k.map(n,function(e){return(e=e.parentNode)&&!i(e)&&0>t.indexOf(e)?(t.push(e),e):T});return v(t,e)},parent:function(e){return v($(this.pluck("parentNode")),e)},children:function(e){return v(this.map(function(){return h(this)}),e)},contents:function(){return this.map(function(){return I.call(this.childNodes)})},siblings:function(e){return v(this.map(function(e,t){return A.call(h(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return k.map(this,function(t){return t[e]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=null),"none"==L(this,"").getPropertyValue("display")&&(this.style.display=p(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var n=t(e);if(this[0]&&!n)var i=k(e).get(0),r=i.parentNode||this.length>1;return this.each(function(t){k(this).wrapAll(n?e.call(this,t):r?i.cloneNode(!0):i)})},wrapAll:function(e){if(this[0]){k(this[0]).before(e=k(e));for(var t;(t=e.children()).length;)e=t.first();k(e).append(this)}return this},wrapInner:function(e){var n=t(e);return this.each(function(t){var i=k(this),r=i.contents(),o=n?e.call(this,t):e;r.length?r.wrapAll(o):i.append(o)})},unwrap:function(){return this.parent().each(function(){k(this).replaceWith(k(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var t=k(this);(e===T?"none"==t.css("display"):e)?t.show():t.hide()})},prev:function(e){return k(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return k(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return e===T?this.length>0?this[0].innerHTML:null:this.each(function(t){var n=this.innerHTML;k(this).empty().append(g(this,e,t,n))})},text:function(e){return e===T?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=e})},attr:function(e,t){var n;return"string"==typeof e&&t===T?0==this.length||1!==this[0].nodeType?T:"value"==e&&"INPUT"==this[0].nodeName?this.val():!(n=this[0].getAttribute(e))&&e in this[0]?this[0][e]:n:this.each(function(n){if(1===this.nodeType)if(r(e))for(_ in e)b(this,_,e[_]);else b(this,e,g(this,t,n,this.getAttribute(e)))})},removeAttr:function(e){return this.each(function(){1===this.nodeType&&b(this,e)})},prop:function(e,t){return t===T?this[0]&&this[0][e]:this.each(function(n){this[e]=g(this,t,n,this[e])})},data:function(e,t){var n=this.attr("data-"+u(e),t);return null!==n?w(n):T},val:function(e){return e===T?this[0]&&(this[0].multiple?k(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value):this.each(function(t){this.value=g(this,e,t,this.value)})},offset:function(e){if(e)return this.each(function(t){var n=k(this),i=g(this,e,t,n.offset()),r=n.offsetParent().offset(),o={top:i.top-r.top,left:i.left-r.left};"static"==n.css("position")&&(o.position="relative"),n.css(o)});if(0==this.length)return null;var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(t,n){if(2>arguments.length&&"string"==typeof t)return this[0]&&(this[0].style[S(t)]||L(this[0],"").getPropertyValue(t));var i="";if("string"==e(t))n||0===n?i=u(t)+":"+f(t,n):this.each(function(){this.style.removeProperty(u(t))});else for(_ in t)t[_]||0===t[_]?i+=u(_)+":"+f(_,t[_])+";":this.each(function(){this.style.removeProperty(u(_))});return this.each(function(){this.style.cssText+=";"+i})},index:function(e){return e?this.indexOf(k(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return C.some.call(this,function(e){return this.test(y(e))},c(e))},addClass:function(e){return this.each(function(t){E=[];var n=y(this),i=g(this,e,t,n);i.split(/\s+/g).forEach(function(e){k(this).hasClass(e)||E.push(e)},this),E.length&&y(this,n+(n?" ":"")+E.join(" "))})},removeClass:function(e){return this.each(function(t){return e===T?y(this,""):(E=y(this),g(this,e,t,E).split(/\s+/g).forEach(function(e){E=E.replace(c(e)," ")}),y(this,E.trim()),T)})},toggleClass:function(e,t){return this.each(function(n){var i=k(this),r=g(this,e,n,y(this));r.split(/\s+/g).forEach(function(e){(t===T?!i.hasClass(e):t)?i.addClass(e):i.removeClass(e)})})},scrollTop:function(){return this.length?"scrollTop"in this[0]?this[0].scrollTop:this[0].scrollY:T},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),n=this.offset(),i=j.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(k(e).css("margin-top"))||0,n.left-=parseFloat(k(e).css("margin-left"))||0,i.top+=parseFloat(k(t[0]).css("border-top-width"))||0,i.left+=parseFloat(k(t[0]).css("border-left-width"))||0,{top:n.top-i.top,left:n.left-i.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||F.body;e&&!j.test(e.nodeName)&&"static"==k(e).css("position");)e=e.offsetParent;return e})}},k.fn.detach=k.fn.remove,["width","height"].forEach(function(e){k.fn[e]=function(t){var r,o=this[0],s=e.replace(/./,function(e){return e[0].toUpperCase()});return t===T?n(o)?o["inner"+s]:i(o)?o.documentElement["offset"+s]:(r=this.offset())&&r[e]:this.each(function(n){o=k(this),o.css(e,g(this,t,n,o[e]()))})}}),H.forEach(function(t,n){var i=n%2;k.fn[t]=function(){var t,r,o=k.map(arguments,function(n){return t=e(n),"object"==t||"array"==t||null==n?n:X.fragment(n)}),s=this.length>1;return 1>o.length?this:this.each(function(e,t){r=i?t:t.parentNode,t=0==n?t.nextSibling:1==n?t.firstChild:2==n?t:null,o.forEach(function(e){if(s)e=e.cloneNode(!0);else if(!r)return k(e).remove();x(r.insertBefore(e,t),function(e){null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src||window.eval.call(window,e.innerHTML)})})})},k.fn[i?t+"To":"insert"+(n?"Before":"After")]=function(e){return k(e)[t](this),this}}),X.Z.prototype=k.fn,X.uniq=$,X.deserializeValue=w,k.zepto=X,k}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(e){function t(e){var t=this.os={},n=this.browser={},i=e.match(/WebKit\/([\d.]+)/),r=e.match(/(Android)\s+([\d.]+)/),o=e.match(/(iPad).*OS\s([\d_]+)/),s=!o&&e.match(/(iPhone\sOS)\s([\d_]+)/),a=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),d=a&&e.match(/TouchPad/),l=e.match(/Kindle\/([\d.]+)/),u=e.match(/Silk\/([\d._]+)/),c=e.match(/(BlackBerry).*Version\/([\d.]+)/),f=e.match(/(BB10).*Version\/([\d.]+)/),p=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),h=e.match(/PlayBook/),m=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),v=e.match(/Firefox\/([\d.]+)/);(n.webkit=!!i)&&(n.version=i[1]),r&&(t.android=!0,t.version=r[2]),s&&(t.ios=t.iphone=!0,t.version=s[2].replace(/_/g,".")),o&&(t.ios=t.ipad=!0,t.version=o[2].replace(/_/g,".")),a&&(t.webos=!0,t.version=a[2]),d&&(t.touchpad=!0),c&&(t.blackberry=!0,t.version=c[2]),f&&(t.bb10=!0,t.version=f[2]),p&&(t.rimtabletos=!0,t.version=p[2]),h&&(n.playbook=!0),l&&(t.kindle=!0,t.version=l[1]),u&&(n.silk=!0,n.version=u[1]),!u&&t.android&&e.match(/Kindle Fire/)&&(n.silk=!0),m&&(n.chrome=!0,n.version=m[1]),v&&(n.firefox=!0,n.version=v[1]),t.tablet=!!(o||h||r&&!e.match(/Mobile/)||v&&e.match(/Tablet/)),t.phone=!(t.tablet||!(r||s||a||c||f||m&&e.match(/Android/)||m&&e.match(/CriOS\/([\d.]+)/)||v&&e.match(/Mobile/)))}t.call(e,navigator.userAgent),e.__detect=t}(Zepto),function(e){function t(e){return e._zid||(e._zid=p++)}function n(e,n,o,s){if(n=i(n),n.ns)var a=r(n.ns);return(f[t(e)]||[]).filter(function(e){return!(!e||n.e&&e.e!=n.e||n.ns&&!a.test(e.ns)||o&&t(e.fn)!==t(o)||s&&e.sel!=s)})}function i(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function r(e){return RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function o(t,n,i){"string"!=e.type(t)?e.each(t,i):t.split(/\s/).forEach(function(e){i(e,n)})}function s(e,t){return e.del&&("focus"==e.e||"blur"==e.e)||!!t}function a(e){return m[e]||e}function d(n,r,d,l,u,c){var p=t(n),h=f[p]||(f[p]=[]);o(r,d,function(t,r){var o=i(t);o.fn=r,o.sel=l,o.e in m&&(r=function(t){var n=t.relatedTarget;return!n||n!==this&&!e.contains(this,n)?o.fn.apply(this,arguments):void 0}),o.del=u&&u(r,t);var d=o.del||r;o.proxy=function(e){var t=d.apply(n,[e].concat(e.data));return t===!1&&(e.preventDefault(),e.stopPropagation()),t},o.i=h.length,h.push(o),n.addEventListener(a(o.e),o.proxy,s(o,c))})}function l(e,i,r,d,l){var u=t(e);o(i||"",r,function(t,i){n(e,t,i,d).forEach(function(t){delete f[u][t.i],e.removeEventListener(a(t.e),t.proxy,s(t,l))})})}function u(t){var n,i={originalEvent:t};for(n in t)b.test(n)||void 0===t[n]||(i[n]=t[n]);return e.each(y,function(e,n){i[e]=function(){return this[n]=v,t[e].apply(t,arguments)},i[n]=g}),i}function c(e){if(!("defaultPrevented"in e)){e.defaultPrevented=!1;var t=e.preventDefault;e.preventDefault=function(){this.defaultPrevented=!0,t.call(this)}}}var f=(e.zepto.qsa,{}),p=1,h={},m={mouseenter:"mouseover",mouseleave:"mouseout"};h.click=h.mousedown=h.mouseup=h.mousemove="MouseEvents",e.event={add:d,remove:l},e.proxy=function(n,i){if(e.isFunction(n)){var r=function(){return n.apply(i,arguments)};return r._zid=t(n),r}if("string"==typeof i)return e.proxy(n[i],n);throw new TypeError("expected function")},e.fn.bind=function(e,t){return this.each(function(){d(this,e,t)})},e.fn.unbind=function(e,t){return this.each(function(){l(this,e,t)})},e.fn.one=function(e,t){return this.each(function(n,i){d(this,e,t,null,function(e,t){return function(){var n=e.apply(i,arguments);return l(i,t,e),n}})})};var v=function(){return!0},g=function(){return!1},b=/^([A-Z]|layer[XY]$)/,y={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(t,n,i){return this.each(function(r,o){d(o,n,i,t,function(n){return function(i){var r,s=e(i.target).closest(t,o).get(0);return s?(r=e.extend(u(i),{currentTarget:s,liveFired:o}),n.apply(s,[r].concat([].slice.call(arguments,1)))):void 0}})})},e.fn.undelegate=function(e,t,n){return this.each(function(){l(this,t,n,e)})},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,i){return!n||e.isFunction(n)?this.bind(t,n||i):this.delegate(n,t,i)},e.fn.off=function(t,n,i){return!n||e.isFunction(n)?this.unbind(t,n||i):this.undelegate(n,t,i)},e.fn.trigger=function(t,n){return("string"==typeof t||e.isPlainObject(t))&&(t=e.Event(t)),c(t),t.data=n,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(t)})},e.fn.triggerHandler=function(t,i){var r,o;return this.each(function(s,a){r=u("string"==typeof t?e.Event(t):t),r.data=i,r.target=a,e.each(n(a,t.type||t),function(e,t){return o=t.proxy(r),r.isImmediatePropagationStopped()?!1:void 0})}),o},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.trigger(t)}}),["focus","blur"].forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.each(function(){try{this[t]()}catch(e){}}),this}}),e.Event=function(e,t){"string"!=typeof e&&(t=e,e=t.type);var n=document.createEvent(h[e]||"Events"),i=!0;if(t)for(var r in t)"bubbles"==r?i=!!t[r]:n[r]=t[r];return n.initEvent(e,i,!0,null,null,null,null,null,null,null,null,null,null,null,null),n.isDefaultPrevented=function(){return this.defaultPrevented},n}}(Zepto),function(e){function t(t,n,i){var r=e.Event(n);return e(t).trigger(r,i),!r.defaultPrevented}function n(e,n,i,r){return e.global?t(n||b,i,r):void 0}function i(t){t.global&&0===e.active++&&n(t,null,"ajaxStart")}function r(t){t.global&&!--e.active&&n(t,null,"ajaxStop")}function o(e,t){var i=t.context;return t.beforeSend.call(i,e,t)===!1||n(t,i,"ajaxBeforeSend",[e,t])===!1?!1:(n(t,i,"ajaxSend",[e,t]),void 0)}function s(e,t,i){var r=i.context,o="success";i.success.call(r,e,o,t),n(i,r,"ajaxSuccess",[t,i,e]),d(o,t,i)}function a(e,t,i,r){var o=r.context;r.error.call(o,i,t,e),n(r,o,"ajaxError",[i,r,e]),d(t,i,r)}function d(e,t,i){var o=i.context;i.complete.call(o,t,e),n(i,o,"ajaxComplete",[t,i]),r(i)}function l(){}function u(e){return e&&(e=e.split(";",2)[0]),e&&(e==_?"html":e==T?"json":w.test(e)?"script":x.test(e)&&"xml")||"text"}function c(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function f(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=c(t.url,t.data))}function p(t,n,i,r){var o=!e.isFunction(n);return{url:t,data:o?n:void 0,success:o?e.isFunction(i)?i:void 0:n,dataType:o?r||i:i}}function h(t,n,i,r){var o,s=e.isArray(n);e.each(n,function(n,a){o=e.type(a),r&&(n=i?r:r+"["+(s?"":n)+"]"),!r&&s?t.add(a.name,a.value):"array"==o||!i&&"object"==o?h(t,a,i,n):t.add(n,a)})}var m,v,g=0,b=window.document,y=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,w=/^(?:text|application)\/javascript/i,x=/^(?:text|application)\/xml/i,T="application/json",_="text/html",k=/^\s*$/;e.active=0,e.ajaxJSONP=function(t){if(!("type"in t))return e.ajax(t);var n,i="jsonp"+ ++g,r=b.createElement("script"),d=function(){clearTimeout(n),e(r).remove(),delete window[i]},u=function(e){d(),e&&"timeout"!=e||(window[i]=l),a(null,e||"abort",c,t)},c={abort:u};return o(c,t)===!1?(u("abort"),!1):(window[i]=function(e){d(),s(e,c,t)},r.onerror=function(){u("error")},r.src=t.url.replace(/=\?/,"="+i),e("head").append(r),t.timeout>0&&(n=setTimeout(function(){u("timeout")},t.timeout)),c)},e.ajaxSettings={type:"GET",beforeSend:l,success:l,error:l,complete:l,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:T,xml:"application/xml, text/xml",html:_,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},e.ajax=function(t){var n=e.extend({},t||{});for(m in e.ajaxSettings)void 0===n[m]&&(n[m]=e.ajaxSettings[m]);i(n),n.crossDomain||(n.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(n.url)&&RegExp.$2!=window.location.host),n.url||(n.url=""+window.location),f(n),n.cache===!1&&(n.url=c(n.url,"_="+Date.now()));var r=n.dataType,d=/=\?/.test(n.url);if("jsonp"==r||d)return d||(n.url=c(n.url,"callback=?")),e.ajaxJSONP(n);var p,h=n.accepts[r],g={},b=/^([\w-]+:)\/\//.test(n.url)?RegExp.$1:window.location.protocol,y=n.xhr();n.crossDomain||(g["X-Requested-With"]="XMLHttpRequest"),h&&(g.Accept=h,h.indexOf(",")>-1&&(h=h.split(",",2)[0]),y.overrideMimeType&&y.overrideMimeType(h)),(n.contentType||n.contentType!==!1&&n.data&&"GET"!=n.type.toUpperCase())&&(g["Content-Type"]=n.contentType||"application/x-www-form-urlencoded"),n.headers=e.extend(g,n.headers||{}),y.onreadystatechange=function(){if(4==y.readyState){y.onreadystatechange=l,clearTimeout(p);var t,i=!1;if(y.status>=200&&300>y.status||304==y.status||0==y.status&&"file:"==b){r=r||u(y.getResponseHeader("content-type")),t=y.responseText;try{"script"==r?(1,eval)(t):"xml"==r?t=y.responseXML:"json"==r&&(t=k.test(t)?null:e.parseJSON(t))}catch(o){i=o}i?a(i,"parsererror",y,n):s(t,y,n)}else a(null,y.status?"error":"abort",y,n)}};var w="async"in n?n.async:!0;y.open(n.type,n.url,w);for(v in n.headers)y.setRequestHeader(v,n.headers[v]);return o(y,n)===!1?(y.abort(),!1):(n.timeout>0&&(p=setTimeout(function(){y.onreadystatechange=l,y.abort(),a(null,"timeout",y,n)},n.timeout)),y.send(n.data?n.data:null),y)},e.get=function(){return e.ajax(p.apply(null,arguments))},e.post=function(){var t=p.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=p.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,n,i){if(!this.length)return this;var r,o=this,s=t.split(/\s/),a=p(t,n,i),d=a.success;return s.length>1&&(a.url=s[0],r=s[1]),a.success=function(t){o.html(r?e("<div>").html(t.replace(y,"")).find(r):t),d&&d.apply(o,arguments)},e.ajax(a),this};var E=encodeURIComponent;e.param=function(e,t){var n=[];return n.add=function(e,t){this.push(E(e)+"="+E(t))},h(n,e,t),n.join("&").replace(/%20/g,"+")}}(Zepto),function(e){e.fn.serializeArray=function(){var t,n=[];return e(Array.prototype.slice.call(this.get(0).elements)).each(function(){t=e(this);var i=t.attr("type");"fieldset"!=this.nodeName.toLowerCase()&&!this.disabled&&"submit"!=i&&"reset"!=i&&"button"!=i&&("radio"!=i&&"checkbox"!=i||this.checked)&&n.push({name:t.attr("name"),value:t.val()})}),n},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(t)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(e,t){function n(e){return i(e.replace(/([a-z])([A-Z])/,"$1-$2"))}function i(e){return e.toLowerCase()}function r(e){return o?o+e:i(e)}var o,s,a,d,l,u,c,f,p="",h={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},m=window.document,v=m.createElement("div"),g=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,b={};e.each(h,function(e,n){return v.style[e+"TransitionProperty"]!==t?(p="-"+i(e)+"-",o=n,!1):t}),s=p+"transform",b[a=p+"transition-property"]=b[d=p+"transition-duration"]=b[l=p+"transition-timing-function"]=b[u=p+"animation-name"]=b[c=p+"animation-duration"]=b[f=p+"animation-timing-function"]="",e.fx={off:o===t&&v.style.transitionProperty===t,speeds:{_default:400,fast:200,slow:600},cssPrefix:p,transitionEnd:r("TransitionEnd"),animationEnd:r("AnimationEnd")},e.fn.animate=function(t,n,i,r){return e.isPlainObject(n)&&(i=n.easing,r=n.complete,n=n.duration),n&&(n=("number"==typeof n?n:e.fx.speeds[n]||e.fx.speeds._default)/1e3),this.anim(t,n,i,r)},e.fn.anim=function(i,r,o,p){var h,m,v,y={},w="",x=this,T=e.fx.transitionEnd;if(r===t&&(r=.4),e.fx.off&&(r=0),"string"==typeof i)y[u]=i,y[c]=r+"s",y[f]=o||"linear",T=e.fx.animationEnd;else{m=[];for(h in i)g.test(h)?w+=h+"("+i[h]+") ":(y[h]=i[h],m.push(n(h)));w&&(y[s]=w,m.push(s)),r>0&&"object"==typeof i&&(y[a]=m.join(", "),y[d]=r+"s",y[l]=o||"linear")}return v=function(n){if(n!==t){if(n.target!==n.currentTarget)return;e(n.target).unbind(T,v)}e(this).css(b),p&&p.call(this)},r>0&&this.bind(T,v),this.size()&&this.get(0).clientLeft,this.css(y),0>=r&&setTimeout(function(){x.each(function(){v.call(this)})},0),this},v=null}(Zepto),function(e){var t=[],n=function(){},i={defaultPath:"/",before:n,on:n,notfound:n},r={current:null,previous:null,config:function(e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return r},add:function(e,n,i){return e&&n&&("function"==typeof n&&(i=n,n=null),t.push({path:e,name:n,fn:i||function(){}})),r},go:function(e){return location.hash=e,r},back:function(e){return r.previous?(history.back(),r.previous=null):e&&(location.hash=e),r}},o=function(){var e=location.hash.slice(1),n=!1,o=r.current;e||(e=i.defaultPath),o&&o!=r.previous&&(r.previous=o),r.current=e;for(var s=0,a=t.length;a>s&&!n;s++){var d=t[s],l=d.path,u=d.name,c=d.fn;if("string"==typeof l)l.toLowerCase()==e.toLowerCase()&&(i.before.call(r,l,u),c.call(r),i.on.call(r,l,u),n=!0);else{var f=e.match(l);f&&(i.before.call(r,l,u,f),c.apply(r,f),i.on.call(r,l,u,f),n=!0)}}return n||i.notfound.call(r),r};r.init=function(){return e.addEventListener("hashchange",o),o()},r.reload=o,e.ruto=r}(window),function(e,t){function n(e,n){i.addType(e,function(o,s,a){var d,l,u,c,f=s,p=(new Date).getTime();if(!o){f={},c=[],u=0;try{for(o=n.length;o=n.key(u++);)r.test(o)&&(l=JSON.parse(n.getItem(o)),l.expires&&p>=l.expires?c.push(o):f[o.replace(r,"")]=l.data);for(;o=c.pop();)n.removeItem(o)}catch(h){}return f}if(o="__amplify__"+o,s===t){if(d=n.getItem(o),l=d?JSON.parse(d):{expires:-1},!(l.expires&&p>=l.expires))return l.data;n.removeItem(o)}else if(null===s)n.removeItem(o);else{l=JSON.stringify({data:s,expires:a.expires?p+a.expires:null});try{n.setItem(o,l)}catch(h){i[e]();try{n.setItem(o,l)}catch(h){throw i.error()}}}return f})}var i=e.store=function(e,t,n){var r=i.type;return n&&n.type&&n.type in i.types&&(r=n.type),i.types[r](e,t,n||{})};i.types={},i.type=null,i.addType=function(e,t){i.type||(i.type=e),i.types[e]=t,i[e]=function(t,n,r){return r=r||{},r.type=e,i(t,n,r)}},i.error=function(){return"amplify.store quota exceeded"};var r=/^__amplify__/;for(var o in{localStorage:1,sessionStorage:1})try{window[o].setItem("__amplify__","x"),window[o].removeItem("__amplify__"),n(o,window[o])}catch(s){}if(!i.types.localStorage&&window.globalStorage)try{n("globalStorage",window.globalStorage[window.location.hostname]),"sessionStorage"===i.type&&(i.type="globalStorage")}catch(s){}(function(){if(!i.types.localStorage){var e=document.createElement("div"),n="amplify";e.style.display="none",document.getElementsByTagName("head")[0].appendChild(e);try{e.addBehavior("#default#userdata"),e.load(n)}catch(r){return e.parentNode.removeChild(e),t}i.addType("userData",function(r,o,s){e.load(n);var a,d,l,u,c,f=o,p=(new Date).getTime();if(!r){for(f={},c=[],u=0;a=e.XMLDocument.documentElement.attributes[u++];)d=JSON.parse(a.value),d.expires&&p>=d.expires?c.push(a.name):f[a.name]=d.data;for(;r=c.pop();)e.removeAttribute(r);return e.save(n),f}if(r=r.replace(/[^\-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-"),r=r.replace(/^-/,"_-"),o===t){if(a=e.getAttribute(r),d=a?JSON.parse(a):{expires:-1},!(d.expires&&p>=d.expires))return d.data;e.removeAttribute(r)}else null===o?e.removeAttribute(r):(l=e.getAttribute(r),d=JSON.stringify({data:o,expires:s.expires?p+s.expires:null}),e.setAttribute(r,d));try{e.save(n)}catch(h){null===l?e.removeAttribute(r):e.setAttribute(r,l),i.userData();try{e.setAttribute(r,d),e.save(n)}catch(h){throw null===l?e.removeAttribute(r):e.setAttribute(r,l),i.error()}}return f})}})(),function(){function e(e){return e===t?t:JSON.parse(JSON.stringify(e))}var n={},r={};i.addType("memory",function(i,o,s){return i?o===t?e(n[i]):(r[i]&&(clearTimeout(r[i]),delete r[i]),null===o?(delete n[i],null):(n[i]=o,s.expires&&(r[i]=setTimeout(function(){delete n[i],delete r[i]},s.expires)),o)):e(n)})}()}(this.amplify=this.amplify||{});var Hogan={};if(function(e,t){function n(e,t,n){var i;return t&&"object"==typeof t&&(null!=t[e]?i=t[e]:n&&t.get&&"function"==typeof t.get&&(i=t.get(e))),i}function i(e,t,n,i){function r(){}function o(){}r.prototype=e,o.prototype=e.subs;var s,a=new r;a.subs=new o,a.subsText={},a.ib();for(s in t)a.subs[s]=t[s],a.subsText[s]=i;for(s in n)a.partials[s]=n[s];return a}function r(e){return(null===e||void 0===e?"":e)+""}function o(e){return e=r(e),c.test(e)?e.replace(s,"&amp;").replace(a,"&lt;").replace(d,"&gt;").replace(l,"&#39;").replace(u,"&quot;"):e}e.Template=function(e,t,n,i){e=e||{},this.r=e.code||this.r,this.c=n,this.options=i||{},this.text=t||"",this.partials=e.partials||{},this.subs=e.subs||{},this.ib()},e.Template.prototype={r:function(){return""},v:o,t:r,render:function(e,t,n){return this.ri([e],t||{},n)},ri:function(e,t,n){return this.r(e,t,n)},ep:function(e,t){var n=this.partials[e],r=t[n.name];if(n.instance&&n.base==r)return n.instance;if("string"==typeof r){if(!this.c)throw Error("No compiler available.");r=this.c.compile(r,this.options)}return r?(this.partials[e].base=r,n.subs&&(void 0===this.activeSub&&(t.stackText=this.text),r=i(r,n.subs,n.partials,t.stackText||this.text)),this.partials[e].instance=r,r):null},rp:function(e,t,n,i){var r=this.ep(e,n);return r?r.ri(t,n,i):""},rs:function(e,t,n){var i=e[e.length-1];if(!f(i))return n(e,t,this),void 0;for(var r=0;i.length>r;r++)e.push(i[r]),n(e,t,this),e.pop()},s:function(e,t,n,i,r,o,s){var a;return f(e)&&0===e.length?!1:("function"==typeof e&&(e=this.ms(e,t,n,i,r,o,s)),a=!!e,!i&&a&&t&&t.push("object"==typeof e?e:t[t.length-1]),a)},d:function(e,t,i,r){var o,s=e.split("."),a=this.f(s[0],t,i,r),d=this.options.modelGet,l=null;if("."===e&&f(t[t.length-2]))a=t[t.length-1];else for(var u=1;s.length>u;u++)o=n(s[u],a,d),null!=o?(l=a,a=o):a="";return r&&!a?!1:(r||"function"!=typeof a||(t.push(l),a=this.mv(a,t,i),t.pop()),a)},f:function(e,t,i,r){for(var o=!1,s=null,a=!1,d=this.options.modelGet,l=t.length-1;l>=0;l--)if(s=t[l],o=n(e,s,d),null!=o){a=!0;break}return a?(r||"function"!=typeof o||(o=this.mv(o,t,i)),o):r?!1:""},ls:function(e,t,n,i,o){var s=this.options.delimiters;return this.options.delimiters=o,this.b(this.ct(r(e.call(t,i)),t,n)),this.options.delimiters=s,!1},ct:function(e,t,n){if(this.options.disableLambda)throw Error("Lambda features disabled.");return this.c.compile(e,this.options).render(t,n)},b:t?function(e){this.buf.push(e)}:function(e){this.buf+=e},fl:t?function(){var e=this.buf.join("");return this.buf=[],e}:function(){var e=this.buf;return this.buf="",e
},ib:function(){this.buf=t?[]:""},ms:function(e,t,n,i,r,o,s){var a,d=t[t.length-1],l=e.call(d);return"function"==typeof l?i?!0:(a=this.activeSub&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(l,d,n,a.substring(r,o),s)):l},mv:function(e,t,n){var i=t[t.length-1],o=e.call(i);return"function"==typeof o?this.ct(r(o.call(i)),i,n):o},sub:function(e,t,n,i){var r=this.subs[e];r&&(this.activeSub=e,r(t,n,this,i),this.activeSub=!1)}};var s=/&/g,a=/</g,d=/>/g,l=/\'/g,u=/\"/g,c=/[&<>\"\']/,f=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}}("undefined"!=typeof exports?exports:Hogan),function(){function e(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!1),void 0):(e.attachEvent("on"+t,n),void 0)}function t(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return b[e.which]?b[e.which]:y[e.which]?y[e.which]:String.fromCharCode(e.which).toLowerCase()}function n(e,t){return e.sort().join(",")===t.sort().join(",")}function i(e,t){e=e||{};var n,i=!1;for(n in k)e[n]&&k[n]>t?i=!0:k[n]=0;i||(S=!1)}function r(e,t,i,r,o){var s,a,d=[],u=i.type;if(!T[e])return[];for("keyup"==u&&l(e)&&(t=[e]),s=0;T[e].length>s;++s)a=T[e][s],a.seq&&k[a.seq]!=a.level||u==a.action&&("keypress"==u&&!i.metaKey&&!i.ctrlKey||n(t,a.modifiers))&&(r&&a.combo==o&&T[e].splice(s,1),d.push(a));return d}function o(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function s(e,t,n){C.stopCallback(t,t.target||t.srcElement,n)||e(t,n)===!1&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,t.cancelBubble=!0)}function a(e,t){var n,a=r(e,o(t),t),d={},u=0,c=!1;for(n=0;a.length>n;++n)a[n].seq?(c=!0,u=Math.max(u,a[n].level),d[a[n].seq]=1,s(a[n].callback,t,a[n].combo)):c||S||s(a[n].callback,t,a[n].combo);t.type!=S||l(e)||i(d,u)}function d(e){"number"!=typeof e.which&&(e.which=e.keyCode);var n=t(e);if(n)return"keyup"==e.type&&E==n?(E=!1,void 0):(a(n,e),void 0)}function l(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function u(){clearTimeout(g),g=setTimeout(i,1e3)}function c(){if(!v){v={};for(var e in b)e>95&&112>e||b.hasOwnProperty(e)&&(v[b[e]]=e)}return v}function f(e,t,n){return n||(n=c()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function p(e,n,r,o){k[e]=0,o||(o=f(n[0],[]));var a,d=function(){S=o,++k[e],u()},l=function(n){s(r,n,e),"keyup"!==o&&(E=t(n)),setTimeout(i,10)};for(a=0;n.length>a;++a)h(n[a],n.length-1>a?d:l,o,e,a)}function h(e,t,n,i,o){_[e+":"+n]=t,e=e.replace(/\s+/g," ");var s,a,d,u=e.split(" "),c=[];if(u.length>1)return p(e,u,t,n),void 0;for(d="+"===e?["+"]:e.split("+"),s=0;d.length>s;++s)a=d[s],x[a]&&(a=x[a]),n&&"keypress"!=n&&w[a]&&(a=w[a],c.push("shift")),l(a)&&c.push(a);n=f(a,c,n),T[a]||(T[a]=[]),r(a,c,{type:n},!i,e),T[a][i?"unshift":"push"]({callback:t,modifiers:c,action:n,seq:i,level:o,combo:e})}function m(e,t,n){for(var i=0;e.length>i;++i)h(e[i],t,n)}for(var v,g,b={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},y={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},w={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},x={option:"alt",command:"meta","return":"enter",escape:"esc"},T={},_={},k={},E=!1,S=!1,$=1;20>$;++$)b[111+$]="f"+$;for($=0;9>=$;++$)b[$+96]=$;e(document,"keypress",d),e(document,"keydown",d),e(document,"keyup",d);var C={bind:function(e,t,n){return e=e instanceof Array?e:[e],m(e,t,n),this},unbind:function(e,t){return C.bind(e,function(){},t)},trigger:function(e,t){return _[e+":"+t]&&_[e+":"+t]({},e),this},reset:function(){return T={},_={},this},stopCallback:function(e,t){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.contentEditable&&"true"==t.contentEditable}};window.Mousetrap=C,"function"==typeof define&&define.amd&&define(C)}(),dddns="undefined"==typeof dddns?{}:dddns,dddns.lib=1,dddns="undefined"==typeof dddns?{}:dddns,dddns.TF=function(e){TEMPLATES={"add-feed":new e({code:function(e,t,n){var i=this;return i.b(n=n||""),i.b('<div class="header">    <label for="feed">Feed url</label>    <input id="add-feed" placeholder="feed to add" type="text" autocorrect="off" autocapitalize="off" autofocus="autofocus"></div>'),i.fl()},partials:{},subs:{}}),article:new e({code:function(e,t,n){var i=this;return i.b(n=n||""),i.b('<div class="post-content">    <header>        <h1>            <a id="full_article" href="'),i.b(i.v(i.f("link",e,t,0))),i.b('" target="_blank">'),i.b(i.t(i.f("title",e,t,0))),i.b('<br>            </a>        </h1>        <p class="metadata">            <span class="inline-block">'),i.b(i.v(i.f("date",e,t,0))),i.b(" "),i.s(i.f("author",e,t,1),e,t,0,246,259,"{{ }}")&&(i.rs(e,t,function(e,t,n){n.b("by "),n.b(n.v(n.f("author",e,t,0)))}),e.pop()),i.b(' </span>             <span class="inline-block">'),i.b(i.v(i.f("time_ago",e,t,0))),i.s(i.f("comments_count",e,t,1),e,t,0,349,391,"{{ }}")&&(i.rs(e,t,function(e,t,n){n.b(" &middot; "),n.b(n.v(n.f("comments_count",e,t,0))),n.b(" "),n.b(n.v(n.f("i_comment",e,t,0)))}),e.pop()),i.b('</span>        </p>    </header>    <section class="grouped-tableview">        '),i.b(i.t(i.f("content",e,t,0))),i.b("    </section></div>"),i.fl()},partials:{},subs:{}}),"feed-partial":new e({code:function(e,t,n){var i=this;return i.b(n=n||""),i.s(i.f("icon",e,t,1),e,t,0,9,51,"{{ }}")&&(i.rs(e,t,function(e,t,n){n.b('<img class="fav" src="'),n.b(n.v(n.f("icon",e,t,0))),n.b(n.v(n.f("id",e,t,0))),n.b('.ico">')}),e.pop()),i.s(i.f("icon",e,t,1),e,t,1,0,0,"")||(i.b('<div class="number">'),i.b(i.v(i.f("i",e,t,0))),i.b(".</div>")),i.b('<div class="feed">    <b>'),i.b(i.t(i.f("title",e,t,0))),i.b("</b>    "),i.s(i.f("updated",e,t,1),e,t,0,166,274,"{{ }}")&&(i.rs(e,t,function(e,t,n){n.b('        <span class="metadata">            <span class="inline-block">'),n.b(n.v(n.f("updated",e,t,0))),n.b("</span>         </span>    ")}),e.pop()),i.b("</div>"),i.fl()},partials:{},subs:{}}),"feeds-load":new e({code:function(e,t,n){var i=this;return i.b(n=n||""),i.s(i.f("loading",e,t,1),e,t,0,12,53,"{{ }}")&&(i.rs(e,t,function(e,t,n){n.b('<div class="loader">Loading&hellip;</div>')}),e.pop()),i.s(i.f("load_error",e,t,1),e,t,0,80,130,"{{ }}")&&(i.rs(e,t,function(e,t,n){n.b('<div class="load-error">Couldn\'t load feeds.</div>')}),e.pop()),i.fl()},partials:{},subs:{}}),feeds:new e({code:function(e,t,n){var i=this;return i.b(n=n||""),i.b('<li id="feed-'),i.b(i.v(i.f("id",e,t,0))),i.b('" data-index="'),i.b(i.v(i.f("i",e,t,0))),i.b('" class="'),i.b(i.v(i.f("type",e,t,0))),i.b('">    '),i.s(i.f("urlid",e,t,1),e,t,0,71,111,"{{ }}")&&(i.rs(e,t,function(e,t,n){n.b('<a href="#/feed/'),n.b(n.v(n.f("urlid",e,t,0))),n.b('" class="">    ')}),e.pop()),i.b("    "),i.s(i.f("urlid",e,t,1),e,t,1,0,0,"")||(i.b('<a href="#/feed/'),i.b(i.v(i.f("id",e,t,0))),i.b('" class="">    ')),i.b(i.rp("<feed_partial0",e,t,"")),i.b("</a>"),i.s(i.f("unread",e,t,1),e,t,0,214,255,"{{ }}")&&(i.rs(e,t,function(e,t,n){n.b('<span class="count">'),n.b(n.v(n.f("unread",e,t,0))),n.b("</span></a>")}),e.pop()),i.b("</li>"),i.fl()},partials:{"<feed_partial0":{name:"feed_partial",partials:{},subs:{}}},subs:{}}),headline:new e({code:function(e,t,n){var i=this;return i.b(n=n||""),i.b('<li id="article-'),i.b(i.v(i.f("id",e,t,0))),i.b('" data-index="'),i.b(i.v(i.f("i",e,t,0))),i.b('" class="'),i.b(i.v(i.f("type",e,t,0))),i.b('"><a href="#/article/'),i.b(i.v(i.f("id",e,t,0))),i.b("/"),i.b(i.v(i.f("i",e,t,0))),i.b('" class=""><div class="number">'),i.b(i.v(i.f("i",e,t,0))),i.b('.</div><div class="feed"><b>'),i.b(i.t(i.f("title",e,t,0))),i.b("</b></div></a></li>"),i.fl()},partials:{},subs:{}}),login:new e({code:function(e,t,n){var i=this;return i.b(n=n||""),i.b('<div class="post-content">    <section class="grouped-tableview">            <form method="post">            <table>                <tbody>                    <tr>                        <td><label for="username">Username</td>                        <td><input id="username" class="" placeholder="username" type="text" autocorrect="off" autocapitalize="off" autofocus="autofocus"></td>                    </tr>                    <tr>                        <td><label for="password">Password</label></td>                        <td><input id="password" class="" placeholder="password" type="password"></td>                    </tr>                    <tr>                        <td><input type="button" class="" value="Login" id="login"></td>                    </tr>                    <tr>                        <td colspan="2"><span class="view hidden login-error"></span>                    </tr>                </tbody>            </table>            </form>    </section></div>'),i.fl()},partials:{},subs:{}}),"remove-feed-inline":new e({code:function(e,t,n){var i=this;return i.b(n=n||""),i.b('<span class="q">    '),i.b(i.rp("<feed_partial0",e,t,"")),i.b('    <span class="question"><a class="button delete" href="#/">Delete</a> this feed? <a class="cancel" href="#/">cancel</a> </span></span>'),i.fl()},partials:{"<feed_partial0":{name:"feed_partial",partials:{},subs:{}}},subs:{}}),"remove-feed":new e({code:function(e,t,n){var i=this;return i.b(n=n||""),i.b('<span>    <span class="question"><a class="button delete" href="#/">Delete</a> <a class="cancel" href="#/">cancel</a> '),i.b(i.v(i.f("title",e,t,0))),i.b(" feed? </span></span>"),i.fl()},partials:{},subs:{}})}},dddns="undefined"==typeof dddns?{}:dddns,dddns.ddd=function(e){function t(e){var t=document.body.scrollTop,n=t+window.innerHeight,i=e.offsetTop,r=i+e.offsetHeight,o=n>=r&&i>=t;return o}var n=e.document;n.body,"undefined"==typeof TEMPLATES&&dddns.TF(Hogan.Template);var i={},r={pollRetries:0,pub:function(e,t){var n=i[e];if(n)for(var r=0,o=n.length;o>r;r++)n[r].call(this,t)},sub:function(e,t){i[e]||(i[e]=[]),i[e].push(t)},prevView:null,currentView:null,hideAllViews:function(){for(var e=n.querySelectorAll(".view"),t=0,i=e.length;i>t;t++)$(e[t]).addClass("hidden")},tmpl:function(e,t){var n=TEMPLATES[e];if(n)return t?n.render(t):n},formatDate:function(e,t){var n=new Date(1e3*e),i=""+n.getFullYear()+"/"+r.pad(n.getMonth()+1)+"/"+r.pad(n.getDate());return t&&(i+=" "+r.pad(n.getHours())+":"+r.pad(n.getMinutes())),i},pad:function(e){return 10>e?"0"+e:e},remove:function(e,t){if(0===t)return e.slice(1);if(t==e.length-1)return e.slice(0,e.length-1);var n=e.slice(0,t),i=e.slice(t+1,e.length);return n.push.apply(n,i),n},pollServer:function(){void 0!==r.config.refresh_every&&r.config.refresh_every&&(0>=r.config.refresh_every||(r.pollTimer&&clearTimeout(r.pollTimer),r.pollTimer=setTimeout(r.pollRefresh,6e4*r.config.refresh_every),r.pollRetries=0))},pollServerError:function(){r.pollRetries=r.pollRetries+1;var e=6e4*r.config.refresh_every;r.pollTimer=setTimeout(r.pollRefresh,Math.pow(2,r.pollRetries)*e)},pollRefresh:function(){var e=new Date,t="Poll at "+e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();console.log(t),r.feeds.reload(!0)}},o=2e4,s=function(e,t,n,i){var r=function(e){e.session_id&&amplify.store("feeds-sid",e.session_id),n(e)},o=function(e){i(e)};loginMsg={op:"login",user:e,password:t},a(loginMsg,r,o)},a=function(e,t,n){t||(t=function(){}),n||(n=function(){});var i=function(e){var i=e;if(console.log("<- ",i),i&&!i.error){if(i.content){var o=i.content.error;if("NOT_LOGGED_IN"===o){if(/login/i.test(location.href))return n(i.content);amplify.store("feeds-sid",null),ruto.go("/login"),r.login.render()}}t(i.content)}else n(i)},s=function(e){console.log("*- ",e),n(JSON.parse(JSON.stringify(e)))},a=amplify.store("feeds-sid");a&&(e.sid=a),console.log("->",e),$.ajax({type:"POST",url:r.config.api+"api/",contentType:"application/json",dataType:"json",timeout:o,data:JSON.stringify(e),success:i,error:s})},d={feeds:function(e,t,n){a(e,t,n)},headlines:function(e,t,n){a(e,t,n)},login:function(e,t,n,i){s(e,t,n,i)},updateArticle:function(e,t,n){e.op="updateArticle",a(e,t,n)},catchupFeed:function(e,t,n){a(e,t,n)},subscribeToFeed:function(e,t,n){a(e,t,n)},unsubscribeFeed:function(e,t,n){a(e,t,n)},getConfig:function(e,t,n){a(e,t,n)}},l=r.tmpl,u="Mac";amplify.store.sessionStorage&&"function"==typeof amplify.store.sessionStorage||(amplify.store.sessionStorage=amplify.store.memory);var c=n.querySelector("#view-home .scroll"),f=c.querySelector("section"),p=!1,h=!1,m={};r.feeds={skip:0,skipFeeds:0,feedsRemoved:{},markupFeed:function(e){e.type=e.unread>0?"unread":"read",""===e.title&&(e.title="&nbsp;"),0>e.id&&(-1===e.id?e.urlid="starred":-2===e.id?e.urlid="published":-3===e.id?e.urlid="fresh":-4===e.id?e.urlid="all":-6===e.id&&(e.urlid="recent"));var t=l("feeds"),n=l("feed-partial"),i=e.has_icon&&r.config.iconPath;i&&(e.icon=r.config.iconPath);var o=t.render(e,{feed_partial:n});return i&&delete e.icon,o},markupHeadline:function(e){return e.url="#/article/"+e.id,e.type=e.unread>0?"unread":"read",l("headline",e)},markupFeeds:function(e,t){var n="";t||(t=1);var i=r.feeds.markupFeed;return e.forEach(function(e){e.i=t++,n+=i(e)}),n},markupHeadlines:function(e,t){var n="";t||(t=1);var i=r.feeds.markupHeadline;return e.forEach(function(e){e.i=t++,n+=i(e)}),n},feedsAndMore:function(e,t){var n=r.feeds.markupFeeds(e,t);if(n+=e.length>=r.config.FEED_LIMIT?'<li><a class="more-link">More&hellip;<span class="loader"></span></a></li>':"",e.length>=r.config.FEED_LIMIT){var i=r.feeds.skipFeeds;i||(i=0),r.feeds.skipFeeds=i+r.config.FEED_LIMIT}return n},render:function(e){if(!p){e||(e={});var t=amplify.store("ddd-cached"),n=l("feeds-load"),i=function(e){var t=e.slice(),n='<ul class="tableview tableview-links" id="feedslist">'+r.feeds.feedsAndMore(t)+"</ul>";f.innerHTML=n,r.feed.showSelection(),r.pub("onRenderNews")};if(t){var o=amplify.store("feeds");amplify.store("feeds-by-id");var s=e.delay;s?(p=!0,f.innerHTML=n.render({loading:!0}),setTimeout(function(){p=!1,i(o)},s)):i(o)}else{p=!0,f.innerHTML=n.render({loading:!0});var a=function(){f.innerHTML=n.render({load_error:!0}),r.pub("logAPIError","news")},u=amplify.store("view-mode");msg={op:"getFeeds",cat_id:"-3",unread_only:u?"true":"false"},d.feeds(msg,function(e){if(feedsRemoved={},p=!1,!e||e.error)return a(),void 0;byId={};for(var t=0,n=e.length;n>t;t++){var o=e[t];o.index=t,byId[o.id]=o}amplify.store("feeds",e),amplify.store("feeds-by-id",byId),amplify.store("ddd-cached",!0,{expires:6e5}),i(e),r.pollServer()},function(){p=!1,a(),r.pollServerError()})}}},settings:function(){r.feeds.render({delay:300})},moreFeeds:function(e){$(e).addClass("loading");var t=function(){var t=l("feeds-load");$(e).replaceWith(t.render({load_error:!0})),r.pub("logAPIError","news")},n=amplify.store("view-mode");msg={op:"getFeeds",cat_id:"-3",unread_only:n?"true":"false",limit:""+r.config.FEED_LIMIT,offset:""+r.feeds.skipFeeds},d.feeds(msg,function(n){p=!1,$(e).removeClass("loading");var i=e.parentNode;if(i){if(i.parentNode&&i.parentNode.removeChild(i),!n||n.error)return t(),void 0;var o=amplify.store("feeds"),s=amplify.store("feeds-by-id");o&&o.push.apply(o,n);for(var a=0,d=n.length;d>a;a++){var l=n[a];l.index=a,s[l.id]=l}amplify.store("feeds",o),amplify.store("feeds-by-id",s),amplify.store("ddd-cached",!0,{expires:6e5});var u=r.feeds.feedsAndMore(n,r.feeds.skipFeeds+1);$("#feedslist").append(u),r.feeds.skipFeeds+=r.config.FEED_LIMIT}},function(){p=!1,t()})},more:function(e){console.log("more target is",e),$(e).addClass("loading");var t=r.feeds.currentID;if(t){var n=amplify.store("view-mode");msg={op:"getHeadlines",feed_id:""+t,show_content:"true",view_mode:n?"unread":"",skip:""+r.feeds.skip,limit:""+r.config.ARTICLE_LIMIT};var i=amplify.store("feeds-by-id");i[t],d.headlines(msg,function(n){if(r.feeds.currentID==t){$(e).removeClass("loading");var i=e.parentNode;if(i&&(i.parentNode&&i.parentNode.removeChild(i),n)){var o=n.slice();r.feed.currentHeadlines&&r.feed.currentHeadlines.push.apply(r.feed.currentHeadlines,o);var s=r.feeds.markupHeadlines(o,r.feeds.skip+1);s+=o.length>=r.config.ARTICLE_LIMIT?'<li><a class="more-link">More&hellip;<span class="loader"></span></a></li>':"</ul>",$("#dddlist").append(s),r.feeds.skip+=r.config.ARTICLE_LIMIT}}},function(){})}},reload:function(e){e&&(amplify.store("ddd-cached",null),amplify.store("feeds",null),amplify.store("feeds-by-id",null),r.feeds.render())},markAllRead:function(){var e=r.getSelFeed();if(!e)return"article"===r.currentView&&ruto.go("/"),void 0;var t=e.id;if(!(0>t)){msg={op:"catchupFeed",feed_id:""+t},d.catchupFeed(msg,function(){},function(){});var n=amplify.store("view-mode");n&&(r.feed.currentHeadlines=[]),e.unread=0,r.feed.markFeedRead(e),n&&"home"!==r.currentView&&ruto.go("/"),r.feed.showSelection()}},escapePressed:function(){r.feeds.removeFeedsInline(!0)},removeFeedsInline:function(e){var t=r.feeds.feedToDelete;if(t){var n=$("#feed-"+t.id),i=r.feeds.markupFeed(t);return r.pub("onDialogDone"),e?($(n).replaceWith(i),void 0):(r.feeds.removeFeeds(!1),void 0)}},removeFeeds:function(e){if(e)return $("#view-home h1").html("Feeds"),void 0;var t=r.feeds.feedToDelete;if(t){var n={op:"unsubscribeFeed",feed_id:""+t.id};d.unsubscribeFeed(n,function(e){var n="Feed removed",i="good";"error"in e?(n="Feed not found",i="bad"):r.feeds.removeFromStoreAndUi(t),$(".msg").attr("class","msg "+i).html(n).show(),$("#view-home h1").html("Feeds"),setTimeout(function(){$(".msg").hide()},3e3)},function(e){console.log("unsub err",e)})}},removeFeedInline:function(){if("home"===r.currentView){var e=r.getSel(),t=$(e.siz)[e.sel],n=r.getSelFeed();n.i=n.index+1,r.feeds.feedToDelete=n,$(t).find("a");var i=l("remove-feed-inline"),o=l("feed-partial"),s=i.render(n,{feed_partial:o});$(t).html(s),r.pub("onDialog")}},removeFeed:function(){if("home"===r.currentView){var e=r.getSel();$(e.siz)[e.sel];var t=r.getSelFeed();r.feeds.feedToDelete=t;var n=l("remove-feed");$("#view-home h1").html(n.render({id:t.id,title:t.title}))}},addFeed:function(){var e=l("add-feed");$("#view-home h1").html(e.render({}))},addFeedClicked:function(e){if(e)return $("#view-home h1").html("Feeds"),void 0;var t=$("#add-feed").val();0!==t.length&&(msg={op:"subscribeToFeed",feed_url:t},d.subscribeToFeed(msg,function(e){var t="Feed added",n="bad",i=e.status;if(i){var r=i.code,o=i.message;0===r?(t="Feed already exists",n="good"):1==r?(t="Feed added",n="good"):2==r?t="Invalid URL. "+o:3==r?t="Invalid URL. "+o:4==r?t="Invalid URL. "+o:5==r&&(t="Invalid URL. "+o)}$(".msg").addClass(n).html(t).show(),"good"===n&&($("#view-home h1").html("Feeds"),setTimeout(function(){$(".msg").hide()},3e3))},function(e){console.log("in sub e is",e),$(".msg").addClass("bad").html("Error adding feed ").show()}))},storeAgain:function(e){for(var t=amplify.store("feeds"),n=0,i=t.length;i>n;n++)if(t[n].id===e.id){t[n]=e;break}amplify.store("feeds",t);var r=amplify.store("feeds-by-id");r[e.id]=e,amplify.store("feeds-by-id",r)},cmd_toggleUnread:function(){if(amplify.store("view-mode",!amplify.store("view-mode")),"feed"===r.currentView){r.feed.currentHeadlines=null;var e=amplify.store("feeds-by-id");r.feed.render(r.feeds.currentID,e[r.feeds.currentID])}r.feeds.reload(!0),r.feeds.skipFeeds=0,r.feeds.render()},getConfig:function(){msg={op:"getConfig"},d.getConfig(msg,function(e){for(var t in e)e.hasOwnProperty(t)&&(r.config[t]=e[t]);"icons_url"in r.config&&(r.config.iconPath=r.config.api+r.config.icons_url+"/",r.feeds.render())},function(){})},removeFromStoreAndUi:function(e){for(var t=amplify.store("feeds"),n=0,i=0,o=t.length;o>i;i++)if(t[i].id===e.id){n=i;break}t=r.remove(t,n),amplify.store("feeds",t);var s=amplify.store("feeds-by-id");delete s[e.id],amplify.store("feeds-by-id",s);var a=$("#feed-"+e.id);a.remove()}},r.feed={currentID:null,currentHeadlines:null,renderTitle:function(e,t){var n=e.has_icon&&r.config.iconPath;n?$(t).html('<img class="fav" src='+r.config.iconPath+e.id+".ico>"+e.title):$(t).html(e.title)},render:function(e,t){if(e){var n=parseInt(e,10);if(r.feeds.currentID===n&&null!==r.feed.currentHeadlines)return r.feed.showSelection(),void 0;if(!h){r.feeds.currentID=n,r.feeds.skip=0;var i=t;i||(i=amplify.store("feeds-by-id")[n]),i&&r.feed.renderTitle(i,"#view-feed h1");var o=amplify.store("view-mode");h=!0,tmpl1=l("feeds-load"),$("#view-feed .scroll").html(tmpl1.render({loading:!0})),msg={op:"getHeadlines",feed_id:""+n,show_content:"true",view_mode:o?"unread":"",limit:""+r.config.ARTICLE_LIMIT},d.headlines(msg,function(e){h=!1,r.feeds.currentID==n&&(r.feed.renderHeadlines(e,n),r.feed.showSelection())},function(){h=!1})}}},showSelection:function(e){var t=r.getSel(e);void 0!==t&&(items=$(t.siz),t.sel>=items.length&&t.sel>=items.length&&(t.sel=items.length-1,0>t.sel&&(t.sel=0)),$(items[t.sel]).addClass("sel"))},renderHeadlines:function(e){if(e){var t=e.slice();l("feeds-load"),r.feed.currentHeadlines=t;var n='<ul class="tableview tableview-links" id="dddlist">'+r.feeds.markupHeadlines(t)+(t.length>=r.config.ARTICLE_LIMIT?'<li><a class="more-link">More&hellip;<span class="loader"></span></a></li>':"")+"</ul>";if(t.length>=r.config.ARTICLE_LIMIT){var i=r.feeds.skip;i||(i=0),r.feeds.skip=i+r.config.ARTICLE_LIMIT}$("#view-feed .scroll").html(n),r.pub("adjustCommentsSection"),r.pub("onRenderComments")}},markRead:function(e,t){if(e&&e.unread){e.unread=!1,msg={article_ids:""+e.id,mode:"0",field:"2"},d.updateArticle(msg,function(){},function(){});var n=amplify.store("view-mode");n&&(r.feed.currentHeadlines=r.remove(r.feed.currentHeadlines,t)),r.feed.renderHeadlines(r.feed.currentHeadlines,r.feeds.currentID);var i=amplify.store("feeds-by-id"),o=i[r.feeds.currentID];o.unread=o.unread-1,0>=o.unread&&amplify.store("view-mode")?(r.feeds.removeFromStoreAndUi(o),r.feeds.feedsRemoved[o.id]=o):(r.feed.replaceFeedUI(o),r.feeds.storeAgain(o))}},markFeedRead:function(e){e.type="read";var t=amplify.store("view-mode");if(t&&0>=e.unread)r.feeds.removeFromStoreAndUi(e),r.feeds.feedsRemoved[e.id]=e;else{var n=$("#feed-"+e.id);if(0===n.length)return;$(n[0]).find(".count").text(e.unread)}if(!t){for(var i=0,o=r.feed.currentHeadlines.length;o>i;i++){var s=r.feed.currentHeadlines[i];s.unread=!1}$("#view-feed .unread").attr("class","read"),r.feed.replaceFeedUI(e)}},addArticleToUI:function(e,t){if(e&&r.feeds.currentID==e.feed_id){var n=r.feed.currentHeadlines,i=amplify.store("view-mode");i&&n.splice(e.i-1,0,e),r.feed.renderHeadlines(n,e.feed_id),r.feed.replaceFeedUI(t)}},replaceFeedUI:function(e){e.i=e.index+1;var t=r.feeds.markupFeed(e);$("#feed-"+e.id).replaceWith(t)}},r.login={render:function(){var e=amplify.store("feeds-sid");if(e)return r.feeds.getConfig(),r.feeds.render(),r.pollRefresh(),ruto.go("/"),void 0;ruto.go("/login");var t=l("login");$("#view-login .scroll").html(t.render({}))},doLogin:function(){var e=$("#username").val(),t=$("#password").val();d.login(e,t,function(){$("#view-login .scroll").empty(),ruto.go("/"),r.pollRefresh(),$("#view-home .scroll").focus()},function(e){console.log("login failed",e),$(".login-error").html("Login failed"),$(".login-error").removeClass("hidden")})}},r.article={currentID:null,currentArticle:null,render:function(e,t){if(e){r.article.currentID=e;var n=r.feed.currentHeadlines;if(n){var i=n[t];if(i){r.article.currentArticle=i;var o=amplify.store("feeds-by-id")[r.feeds.currentID];r.feed.renderTitle(o,"#view-article h1"),r.feed.markRead(i,t),i.hasContent=!0,i.updated&&(i.date=r.formatDate(i.updated,!0)),back="#/feed/"+i.feed_id,$("#view-article .header-back-button").attr("href",back);var s=l("article");$("#view-article .scroll").html(s.render(i))}}}},cmd_next:function(e){"article"===r.currentView&&console.log("article.cmd_next dir=",e,r.currentView)},cmd_markUnread:function(){if(console.log("mark unread"),"home"!==r.currentView){var e=r.article.currentArticle;if("feed"===r.currentView){var t=r.getSel();e=r.feed.currentHeadlines[t.sel]}if(e&&!e.unread){e.unread=!0,msg={article_ids:""+e.id,mode:"1",field:"2"},d.updateArticle(msg,function(){},function(){});var n=amplify.store("feeds-by-id")[e.feed_id];if(n)return n.unread=n.unread+1,r.feeds.storeAgain(n),r.feed.addArticleToUI(e,n),r.feed.renderHeadlines(r.feed.currentHeadlines,r.feeds.currentID),"feed"===r.currentView&&r.cmd_move_sel(1),void 0;if(n=r.feeds.feedsRemoved[e.feed_id]){var i=amplify.store("feeds-by-id");n.unread=1;var o=amplify.store("feeds");o.splice(n.index,0,n),amplify.store("feeds",o),delete r.feeds.feedsRemoved[e.feed_id],i[e.feed_id]=n,amplify.store("feeds-by-id",i),r.feed.addArticleToUI(e,n),r.feeds.render()}}}}},r.resetSelections=function(){return m={feeds:{sel:0,name:"feeds",siz:"#feedslist li"},feed:{sel:0,name:"feed",siz:"#dddlist li"},article:{sel:0,name:"article",siz:"#dddlist li"}}},r.init=function(){var e=amplify.store("view-mode");void 0===e&&amplify.store("view-mode",!0),r.login.render(),r.resetSelections(),ruto.init();var t=navigator.userAgent;u=-1!=t.indexOf("Mac")?"Mac":-1!=t.indexOf("Linux")?"Linux":"Windows"},r.cmd_enter=function(){var e=r.getSel();if(void 0!==e){if("article"==r.currentView)return r.cmd_open(),void 0;if(items=$(e.siz),items&&!(0>e.sel||e.sel>=items.length)){var t=$(items[e.sel]).find("a");if(t&&0!==t.length){if("home"===r.currentView){var n=t[0].href;e.cur!=n&&(r.getSel("feed").sel=0),e.cur=n}$(t[0]).click()}}}},r.cmd_goUp=function(){if("home"!==r.currentView){if("article"===r.currentView){var e=amplify.store("view-mode");if(feed=r.getSelFeed(),e&&(!feed||0===feed.unread))return ruto.go("/"),void 0}ruto.back()}},r.getSel=function(e){return kind=void 0!==e?e:"home"===r.currentView?"feeds":r.currentView,kind?m[kind]:void 0},r.getSelFeed=function(){var e=r.getSel(),t=amplify.store("feeds-by-id");if("feeds"===e.name){var n=$(e.siz),i=n[e.sel];if(!i)return;var o=i.getAttribute("id").substring(5);return t[parseInt(o,10)]}return"feed"===e.name?t[r.feeds.currentID]:"article"===e.name?t[r.feeds.currentID]:void 0},r.scrollPage=function(e){window.scrollBy(0,60*e)},r.cmd_open=function(){location.href;var e,t=$("#opener");if("article"===r.currentView){if(articleA=$("#full_article"),!articleA)return;e=articleA.attr("href")}else if("feed"===r.currentView){var n=r.getSel();if(void 0===n)return;var i=r.feed.currentHeadlines;if(i&&n.sel<i.length){var o=i[n.sel];if(e=o.link,!e)return;r.feed.markRead(o,n.sel)}}if(e){t.attr("href",e);var s=document.createEvent("MouseEvents");"Mac"===u?s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!0,!1,!1,!0,0,null):s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!0,!1,!1,!1,0,null),t[0].dispatchEvent(s);var a=amplify.store("view-mode");return feed=r.getSelFeed(),!a||feed&&0!==feed.unread?(r.feed.showSelection(),void 0):(ruto.go("/"),void 0)}},r.cmd_click_feed=function(e){var t=r.getSel("feeds");t&&$(t.siz).removeClass("sel");var n=$(t.siz),i=n.indexOf(e);-1!=i&&(t.sel=i)},r.cmd_move_sel=function(e){var n=r.getSel();if(void 0!==n){if("article"===n.name)return r.scrollPage(e,n),void 0;if(n.sel=n.sel+e,0>n.sel)return n.sel=0,void 0;if(items=$(n.siz),n.sel>=items.length)return n.sel=items.length-1,void 0;if(!(0===items.length||n.sel>=items.length)){$(items[n.sel-e]).removeClass("sel"),$(items[n.sel]).addClass("sel");var i=items[n.sel],o=i.offsetTop;document.body.clientHeight;var s=t(i);if(!s){var a=i.offsetHeight;if(0>e)document.body.scrollTop=o-(a-5);else{var d=a;document.body.scrollTop=document.body.scrollTop+d}}}}},e.ddd=r,r.config=window._ddd_config,delete window._ddd_config,ruto.config({before:function(e,t){r.hideAllViews();var n=$("#view-"+t);$(n).removeClass("hidden"),r.prevView=r.currentView,r.currentView=t},notfound:function(){ruto.go("/")}}).add("/","home",function(){r.feed.showSelection()}).add("/about","about").add("/settings","settings").add("/login","login").add("/login_submit",function(){r.login.attempt_login()}).add(/^\/feed\/(\d+)$/i,"feed",function(e,t){r.feed.render(t)}).add(/^\/feed\/(\w+)$/i,"feed",function(e,t){"starred"===t?id=-1:"published"===t?id=-2:"fresh"===t?id=-3:"all"===t?id=-4:"recent"===t&&(id=-6),r.feed.render(id)}).add(/^\/article\/(\d+)\/(\d+)$/i,"article",function(e,t,n){r.article.render(t,n-1)})},!dddns.poll){var poll=function(){dddns["ddd-plat"]&&dddns.ddd&&dddns.lib?(console.log("everything is loaded"),dddns.ddd(window),dddns["ddd-plat"](window),dddns.poll=1):setTimeout(dddns.poll,75)};dddns.poll=poll,setTimeout(poll,75)}dddns="undefined"==typeof dddns?{}:dddns,dddns["ddd-plat"]=function(e){var t,n=e.document,i=n.body,r={},o=function(){return e.pageYOffset||"CSS1Compat"===n.compatMode&&n.documentElement.scrollTop||i.scrollTop||0},s=function(){r[location.hash.slice(1)]=o()};e.addEventListener("scroll",function(){clearTimeout(t),t=setTimeout(s,500)},!1),ruto.config({on:function(){var t=location.hash.slice(1);e.scrollTo(0,r[t]||0),r[t]=o()}});var a=n.head||n.getElementsByTagName("head")[0],d=function(){var e=window.innerHeight,t=$("view-height");t||(t=n.createElement("style"),t.id="view-height",a.appendChild(t)),t.textContent=".view>.scroll{min-height: "+.85*e+"px}"};e.addEventListener("resize",d,!1),e.addEventListener("orientationchange",d,!1),d(),$("#view-home-settings").on("click",function(){ddd.feeds.settings()}),$("#view-home .more-link").on("click",function(){ddd.feeds.moreFeeds(target)}),$("#view-feed").on("click",".more-link",function(e){ddd.feeds.more(e.target)}),$("#feedslist").on("click","li",function(e){ddd.cmd_click_feed(e.target)}),$("body").on("keydown","#add-feed",function(e){13===e.keyCode&&ddd.feeds.addFeedClicked(),27===e.keyCode&&ddd.feeds.addFeedClicked(!0)}),$("#view-login").on("keydown","input",function(e){13===e.keyCode&&ddd.login.doLogin()}),$("#view-login").on("click","#login",function(){ddd.login.doLogin()}),$("#view-home").on("click",".question .delete",function(){ddd.feeds.removeFeedsInline(!1)}),$("#view-home").on("click",".question .cancel",function(){ddd.feeds.removeFeedsInline(!0)});var l=function(){Mousetrap.bind("j",function(){return ddd.cmd_move_sel(1),!1}),Mousetrap.bind("k",function(){return ddd.cmd_move_sel(-1),!1}),Mousetrap.bind("enter",function(){return ddd.cmd_enter(),!1}),Mousetrap.bind("i",function(){return ddd.cmd_goUp(),!1}),Mousetrap.bind("o",function(){return ddd.cmd_open(),!1}),Mousetrap.bind("A",function(){return ddd.feeds.markAllRead(),!1}),Mousetrap.bind("g r",function(){return ddd.feeds.reload(!0),!1}),Mousetrap.bind("+",function(){return ddd.feeds.addFeed(),!1}),Mousetrap.bind("d d",function(){return ddd.feeds.removeFeedInline(),!1}),Mousetrap.bind("shift+j",function(){return ddd.article.cmd_next(1),!1}),Mousetrap.bind("shift+k",function(){return ddd.article.cmd_next(-1),!1}),Mousetrap.bind("shift+n",function(){return ddd.article.cmd_markUnread(),!1}),Mousetrap.bind("l",function(){return ddd.feeds.cmd_toggleUnread(),!1})},u=function(){Mousetrap.bind("escape",function(){return ddd.feeds.escapePressed(),!1})};ddd.sub("onDialog",function(){Mousetrap.reset(),u()}),ddd.sub("onDialogDone",function(){Mousetrap.reset(),l()}),l(),ddd.init()};var poll=function(){window._ddd_config?(console.log("everything is loaded"),dddns.ddd(window),dddns["ddd-plat"](window),dddns.poll=1):setTimeout(dddns.poll,75)};dddns.poll=poll,setTimeout(poll,75);
//@ sourceMappingURL=ddd.min/ddd.min.web.js.map